#include <stdlib.h>
#include <unistd.h>
#include <string.h>
#include <sys/types.h>
#include <stdio.h>

void winner()
{
  printf("that wasn't too bad now, was it? @ %d\n", time(NULL));
}

int main(int argc, char **argv)
{
  char *a, *b, *c;

  a = malloc(32);
  b = malloc(32);
  c = malloc(32);

  strcpy(a, argv[1]);
  strcpy(b, argv[2]);
  strcpy(c, argv[3]);

  free(c);
  free(b);
  free(a);

  printf("dynamite failed?\n");
}

(gdb) p winner 
$1 = {void (void)} 0x8048864 <winner>
(gdb) 



(gdb) disass main
Dump of assembler code for function main:
0x08048889 <main+0>:    push   %ebp
0x0804888a <main+1>:    mov    %esp,%ebp
0x0804888c <main+3>:    and    $0xfffffff0,%esp
0x0804888f <main+6>:    sub    $0x20,%esp
0x08048892 <main+9>:    movl   $0x20,(%esp)
0x08048899 <main+16>:   call   0x8048ff2 <malloc> /* a = malloc(32); */
0x0804889e <main+21>:   mov    %eax,0x14(%esp)
0x080488a2 <main+25>:   movl   $0x20,(%esp)
0x080488a9 <main+32>:   call   0x8048ff2 <malloc> /* b = malloc(32); */
0x080488ae <main+37>:   mov    %eax,0x18(%esp)
0x080488b2 <main+41>:   movl   $0x20,(%esp)
0x080488b9 <main+48>:   call   0x8048ff2 <malloc> /* c = malloc(32); */
0x080488be <main+53>:   mov    %eax,0x1c(%esp)
0x080488c2 <main+57>:   mov    0xc(%ebp),%eax
0x080488c5 <main+60>:   add    $0x4,%eax
0x080488c8 <main+63>:   mov    (%eax),%eax
0x080488ca <main+65>:   mov    %eax,0x4(%esp)
0x080488ce <main+69>:   mov    0x14(%esp),%eax
0x080488d2 <main+73>:   mov    %eax,(%esp)
0x080488d5 <main+76>:   call   0x8048750 <strcpy@plt>
0x080488da <main+81>:   mov    0xc(%ebp),%eax
0x080488dd <main+84>:   add    $0x8,%eax
0x080488e0 <main+87>:   mov    (%eax),%eax
0x080488e2 <main+89>:   mov    %eax,0x4(%esp)
0x080488e6 <main+93>:   mov    0x18(%esp),%eax
0x080488ea <main+97>:   mov    %eax,(%esp)
0x080488ed <main+100>:  call   0x8048750 <strcpy@plt>
0x080488f2 <main+105>:  mov    0xc(%ebp),%eax
0x080488f5 <main+108>:  add    $0xc,%eax
0x080488f8 <main+111>:  mov    (%eax),%eax
0x080488fa <main+113>:  mov    %eax,0x4(%esp)
0x080488fe <main+117>:  mov    0x1c(%esp),%eax
0x08048902 <main+121>:  mov    %eax,(%esp)
0x08048905 <main+124>:  call   0x8048750 <strcpy@plt>
0x0804890a <main+129>:  mov    0x1c(%esp),%eax
0x0804890e <main+133>:  mov    %eax,(%esp)
0x08048911 <main+136>:  call   0x8049824 <free>
0x08048916 <main+141>:  mov    0x18(%esp),%eax
0x0804891a <main+145>:  mov    %eax,(%esp)
0x0804891d <main+148>:  call   0x8049824 <free>
0x08048922 <main+153>:  mov    0x14(%esp),%eax
0x08048926 <main+157>:  mov    %eax,(%esp)
0x08048929 <main+160>:  call   0x8049824 <free>
0x0804892e <main+165>:  movl   $0x804ac27,(%esp)
0x08048935 <main+172>:  call   0x8048790 <puts@plt>
0x0804893a <main+177>:  leave  
0x0804893b <main+178>:  ret    
End of assembler dump.
(gdb) b *0x08048899         /* a = malloc(32);  */
Breakpoint 2 at 0x8048899: file heap3/heap3.c, line 16.
(gdb) b *0x080488a9         /* b = malloc(32); */
Breakpoint 3 at 0x80488a9: file heap3/heap3.c, line 17.
(gdb) c
Continuing.

Breakpoint 2, 0x08048899 in main (argc=4, argv=0xbffff7f4) at heap3/heap3.c:16
16      in heap3/heap3.c
(gdb) set dis
disable-randomization  disassemble-next-line  disassembly-flavor     displaced-stepping     
(gdb) set disassemble-next-line 
"on", "off" or "auto" expected.
(gdb) set disassemble-next-line on
(gdb) ni
0x0804889e      16      in heap3/heap3.c
0x0804889e <main+21>:    89 44 24 14    mov    %eax,0x14(%esp)
(gdb) x/x $eax /* a= malloc(32)的返回值 */
0x804c008:      0x00000000
(gdb) x/4x 0x804c000
0x804c000:      0x00000000      0x00000029      0x00000000      0x00000000
                (prev_size)     (size+status)
                                /* 0x29: 0b 0010 1001 : 最后一位为1表明本内存块已经使用，且本内存块大小为： 32 + 8 = 40 */
(gdb)

Breakpoint 3, 0x080488a9 in main (argc=4, argv=0xbffff7f4) at heap3/heap3.c:17
17      in heap3/heap3.c
0x080488a9 <main+32>:    e8 44 07 00 00 call   0x8048ff2 <malloc>
0x080488ae <main+37>:    89 44 24 18    mov    %eax,0x18(%esp)
(gdb) ni
0x080488ae      17      in heap3/heap3.c
0x080488ae <main+37>:    89 44 24 18    mov    %eax,0x18(%esp)
(gdb) x/x $eax  /* b= malloc(32)的返回值 */
0x804c030:      0x00000000
(gdb) x/4x 0x804c028
0x804c028:      0x00000000      0x00000029      0x00000000      0x00000000
                (prev_size)     (size+status)
(gdb)  